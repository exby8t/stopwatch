<% unless params.has_key? :widget %>   
<h1>Listing entries</h1>
<% end %>
<table class="table table-bordered table-striped table-hover">
  <tr>
    <th></th>
    <th>Date</th>
    <th>Time</th>
    <th>Description</th>
    <th>Developer</th>
    <th>Project</th>
    <th>Category</th>
        <th></th>
    <% unless params.has_key? :widget %>    
    <% end %>
  </tr>

<% @entries.each do |entry| %>
  <tr id = "<%= entry.developer.id %>">
    <td><%= check_box_tag "entry-#{entry.id}", entry.id,  false, {:class=> "entry-checkbox"} %></td>
    <td><%= entry.date %></td>
    <td><%= entry.hours %> / <%= entry.payment %></td>
    <td><%= truncate(entry.description, :length => 20) %></td>
    <td><%= entry.developer.first_name %></td>
    <td><%= entry.project %></td>
    <td><%= entry.category.code %></td>
    <td>
    <%= button_to 'Show', manage_entry_path(entry), :class => 'btn btn-small', :method => :get %>
    <% unless params.has_key? :widget %>    
        <%= link_to 'Edit', edit_manage_entry_path(entry) %> | 
        <%= link_to 'Destroy', manage_entry_path(entry), method: :delete, data: { confirm: 'Are you sure?' } %>
    <% end %>
    </td>

  </tr>
<% end %>
</table>

<br />

<% unless params.has_key? :widget %>
<%= link_to 'New Entry', new_manage_entry_path %>
<% end %>



<script>
$( document ).ready(function() {

    function setRemoteMessage(msg){
        $('div#remote-message').html(msg).fadeIn();
       // console.log("message is: " + msg)
       // console.log($('div.remote-message'))

    }

    $('.entry-checkbox').change(function(){
        var entryId = $(this).val();
        var path = '/manage/invoices/addEntry/'+entryId + '.json';
        console.log(path)
        

        if ( $(this).is(':checked') ) {
            

            $.ajax({
                url: path,
                beforeSend: function ( xhr ) {
                    //xhr.overrideMimeType("application/json; charset=x-user-defined");
                    },
                error: function(response){
                    alert('bad!');
                    console.log(response.status)
                    },
                success: function(response) {
                    var count = 2;
                    console.log(response) 
                    setRemoteMessage("Entry has been added to your invoice! There are now " + response + " entries added");
                    
                    }
        });


        }
        });


});
</script>
